{% load socialaccount %}
{% extends 'base.html' %}

{% block title %}Login â€“ Lune & Lilas{% endblock %}

{% block content %}

        <!-- Main Content -->
        <main class="flex-1">
            <section class="py-20 min-h-screen">
                <div class="max-w-md mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="text-center mb-8 fade-in">
                        <h1 class="font-heading text-4xl mb-4 text-gray-800">Join Lune & Lilas</h1>
                        <p class="font-body text-lg text-gray-600">Create your account and discover beautiful hair</p>
                    </div>
                    
                    <!-- Registration Form -->
                    <div class="card bg-white soft-shadow-lg">
                        <div class="p-8">
                            <form id="register-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-body font-medium text-gray-700 mb-2">First Name</label>
                                        <input type="text" name="firstName" required class="form-input w-full" placeholder="First name">
                                    </div>
                                    <div>
                                        <label class="block font-body font-medium text-gray-700 mb-2">Last Name</label>
                                        <input type="text" name="lastName" required class="form-input w-full" placeholder="Last name">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block font-body font-medium text-gray-700 mb-2">Email Address</label>
                                    <input type="email" name="email" required class="form-input w-full" placeholder="Enter your email">
                                </div>
                                
                                <div>
                                    <label class="block font-body font-medium text-gray-700 mb-2">Password</label>
                                    <div class="relative">
                                        <input type="password" name="password" id="password" required class="form-input w-full pr-12" placeholder="Create a password">
                                        <button type="button" id="toggle-password" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                            <i data-lucide="eye-off" class="h-5 w-5"></i>
                                        </button>
                                    </div>
                                    <p class="font-body text-sm text-gray-500 mt-1">Must be at least 8 characters</p>
                                </div>
                                
                                <div>
                                    <label class="block font-body font-medium text-gray-700 mb-2">Confirm Password</label>
                                    <input type="password" name="confirmPassword" id="confirmPassword" required class="form-input w-full" placeholder="Confirm your password">
                                </div>
                                
                                <div class="space-y-3">
                                    <div class="flex items-start">
                                        <input type="checkbox" name="newsletter" id="newsletter" class="mt-1 mr-3">
                                        <label for="newsletter" class="font-body text-gray-700">
                                            Subscribe to our newsletter for exclusive offers and hair care tips
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-start">
                                        <input type="checkbox" name="terms" id="terms" required class="mt-1 mr-3">
                                        <label for="terms" class="font-body text-gray-700">
                                            I agree to the <a href="#" class="text-lilac-600 hover:text-lilac-700 underline">Terms of Service</a> 
                                            and <a href="#" class="text-lilac-600 hover:text-lilac-700 underline">Privacy Policy</a>
                                        </label>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary btn-lg w-full button-glow">
                                    Create Account
                                </button>
                            </form>
                            
                            <!-- Social Login -->
                            <div class="mt-8">
                                <div class="relative">
                                    <div class="absolute inset-0 flex items-center">
                                        <div class="w-full border-t border-gray-300"></div>
                                    </div>
                                    <div class="relative flex justify-center text-sm">
                                        <span class="px-2 bg-white font-body text-gray-500">Or sign up with</span>
                                    </div>
                                </div>
                                
                                <div class="mt-6 grid grid-cols-2 gap-3">
                                    <button class="btn btn-secondary flex items-center justify-center">
                                        <i data-lucide="mail" class="h-4 w-4 mr-2"></i>
                                        Google
                                    </button>
                                    <button class="btn btn-secondary flex items-center justify-center">
                                        <i data-lucide="facebook" class="h-4 w-4 mr-2"></i>
                                        Facebook
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Sign In Link -->
                            <div class="mt-8 text-center">
                                <p class="font-body text-gray-600">
                                    Already have an account? 
                                    <a href="login.html" class="font-medium text-lilac-600 hover:text-lilac-700 transition-colors">Sign in</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer will be injected -->
        <div id="footer-container"></div>
    </div>

    <!-- Scripts -->
    <script src="../translations.js"></script>
    <script src="../js/page-templates.js"></script>
    <script src="../js/cart-manager.js"></script>
    <script>
        class RegisterPage {
            constructor() {
                this.currentLanguage = 'en';
                this.cartManager = new CartManager();
                
                this.init();
            }
            
            init() {
                this.renderPage();
                this.setupEventListeners();
                this.cartManager.updateCartCount();
                this.initializeLucideIcons();
                this.setupAnimations();
            }
            
            renderPage() {
                // Inject header
                document.getElementById('header-container').innerHTML = PageTemplates.createHeader('register');
                
                // Inject footer
                document.getElementById('footer-container').innerHTML = PageTemplates.createFooter();
            }
            
            setupEventListeners() {
                // Register form
                const registerForm = document.getElementById('register-form');
                if (registerForm) {
                    registerForm.addEventListener('submit', (e) => this.handleRegisterSubmit(e));
                }
                
                // Password toggle
                const togglePassword = document.getElementById('toggle-password');
                const passwordInput = document.getElementById('password');
                if (togglePassword && passwordInput) {
                    togglePassword.addEventListener('click', () => {
                        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                        passwordInput.setAttribute('type', type);
                        
                        const icon = togglePassword.querySelector('i');
                        if (type === 'password') {
                            icon.setAttribute('data-lucide', 'eye-off');
                        } else {
                            icon.setAttribute('data-lucide', 'eye');
                        }
                        this.initializeLucideIcons();
                    });
                }
                
                // Password validation
                const confirmPasswordInput = document.getElementById('confirmPassword');
                if (passwordInput && confirmPasswordInput) {
                    confirmPasswordInput.addEventListener('blur', () => {
                        if (passwordInput.value !== confirmPasswordInput.value) {
                            confirmPasswordInput.setCustomValidity('Passwords do not match');
                        } else {
                            confirmPasswordInput.setCustomValidity('');
                        }
                    });
                    
                    passwordInput.addEventListener('input', () => {
                        if (confirmPasswordInput.value) {
                            if (passwordInput.value !== confirmPasswordInput.value) {
                                confirmPasswordInput.setCustomValidity('Passwords do not match');
                            } else {
                                confirmPasswordInput.setCustomValidity('');
                            }
                        }
                    });
                }
                
                // Header event listeners
                const cartToggle = document.getElementById('cart-toggle');
                if (cartToggle) {
                    cartToggle.addEventListener('click', () => this.cartManager.toggleCartSidebar());
                }
                
                const mobileCart = document.getElementById('mobile-cart');
                if (mobileCart) {
                    mobileCart.addEventListener('click', () => {
                        this.cartManager.toggleCartSidebar();
                        this.toggleMobileMenu();
                    });
                }
                
                // Mobile menu toggle
                const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
                if (mobileMenuToggle) {
                    mobileMenuToggle.addEventListener('click', () => this.toggleMobileMenu());
                }
                
                // Language toggle
                const langToggle = document.getElementById('lang-toggle');
                if (langToggle) {
                    langToggle.addEventListener('click', () => this.toggleLanguage());
                }
                
                // Newsletter form
                const newsletterForm = document.getElementById('newsletter-form');
                if (newsletterForm) {
                    newsletterForm.addEventListener('submit', (e) => this.handleNewsletterSubmit(e));
                }
            }
            
            handleRegisterSubmit(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const firstName = formData.get('firstName');
                const lastName = formData.get('lastName');
                const email = formData.get('email');
                const password = formData.get('password');
                const confirmPassword = formData.get('confirmPassword');
                const newsletter = formData.get('newsletter');
                const terms = formData.get('terms');
                
                // Validate passwords match
                if (password !== confirmPassword) {
                    this.showNotification('Passwords do not match', 'error');
                    return;
                }
                
                // Validate password strength
                if (password.length < 8) {
                    this.showNotification('Password must be at least 8 characters', 'error');
                    return;
                }
                
                // Show loading state
                const submitButton = e.target.querySelector('button[type="submit"]');
                const originalText = submitButton.textContent;
                submitButton.innerHTML = '<i data-lucide="loader-2" class="h-4 w-4 mr-2 animate-spin"></i>Creating account...';
                submitButton.disabled = true;
                
                // Simulate registration process
                setTimeout(() => {
                    // Mock successful registration
                    localStorage.setItem('lune-lilas-user', JSON.stringify({
                        email: email,
                        firstName: firstName,
                        lastName: lastName,
                        name: `${firstName} ${lastName}`,
                        loggedIn: true,
                        registrationTime: new Date().toISOString(),
                        newsletter: !!newsletter
                    }));
                    
                    // Show success and redirect
                    this.showNotification('Account created successfully! Welcome to Lune & Lilas!', 'success');
                    
                    setTimeout(() => {
                        // Redirect to homepage
                        window.location.href = '../index.html';
                    }, 2000);
                    
                }, 2000);
            }
            
            toggleMobileMenu() {
                const mobileMenu = document.getElementById('mobile-menu');
                const menuToggle = document.getElementById('mobile-menu-toggle');
                const icon = menuToggle?.querySelector('i');
                
                if (mobileMenu) {
                    mobileMenu.classList.toggle('hidden');
                    
                    if (icon) {
                        if (mobileMenu.classList.contains('hidden')) {
                            icon.setAttribute('data-lucide', 'menu');
                        } else {
                            icon.setAttribute('data-lucide', 'x');
                        }
                        this.initializeLucideIcons();
                    }
                }
            }
            
            toggleLanguage() {
                this.currentLanguage = this.currentLanguage === 'en' ? 'fr' : 'en';
                this.cartManager.currentLanguage = this.currentLanguage;
                const langButton = document.getElementById('lang-toggle');
                if (langButton) {
                    langButton.querySelector('span').textContent = this.currentLanguage.toUpperCase();
                }
            }
            
            handleNewsletterSubmit(e) {
                e.preventDefault();
                const form = e.target;
                
                form.innerHTML = `
                    <div class="flex items-center justify-center space-x-3 p-4 bg-sage-500/20 border border-sage-400/30 rounded-full backdrop-blur-sm">
                        <div class="w-5 h-5 bg-sage-300 rounded-full"></div>
                        <p class="text-sage-200 font-medium font-body">Welcome! Check your email for your 15% off code.</p>
                    </div>
                `;
                
                setTimeout(() => {
                    form.innerHTML = `
                        <div class="flex flex-col sm:flex-row gap-4">
                            <input type="email" placeholder="Enter your email address" required class="flex-1 h-12 px-6 bg-white/10 border border-lilac-300/20 text-white placeholder:text-lilac-200 focus:border-lilac-400 focus:ring-lilac-400/20 rounded-full backdrop-blur-sm font-body form-input">
                            <button type="submit" class="h-12 bg-blush-500 hover:bg-blush-600 text-white px-8 rounded-full soft-shadow gentle-hover font-body btn button-glow">Subscribe</button>
                        </div>
                    `;
                }, 3000);
            }
            
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                let bgColor = 'bg-lilac-500';
                if (type === 'success') bgColor = 'bg-sage-500';
                if (type === 'error') bgColor = 'bg-destructive';
                
                notification.className = `fixed top-4 right-4 z-50 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg notification-enter`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('notification-exit');
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, type === 'success' ? 5000 : 3000);
            }
            
            initializeLucideIcons() {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }
            
            setupAnimations() {
                const observerOptions = {
                    threshold: 0.1,
                    rootMargin: '0px 0px -50px 0px'
                };
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('fade-in');
                        }
                    });
                }, observerOptions);
                
                const animatedElements = document.querySelectorAll('.fade-in, .slide-in-left, .slide-in-right');
                animatedElements.forEach(el => observer.observe(el));
            }
        }

        // Initialize the page
        let registerPage;
        document.addEventListener('DOMContentLoaded', () => {
            registerPage = new RegisterPage();
        });
    </script>
{% endblock %}